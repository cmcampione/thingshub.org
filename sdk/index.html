<!DOCTYPE html>

<html lang="it">

<head>

    <meta charset="utf-8" />

    <title>thinghub.org</title>

    <style>
    </style>

    <script src="node_modules/axios/dist/axios.min.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.slim.js"></script>
    
    <script src="dist/thingshub.js"></script>

    <script>

      var endPointAddress = {
          server: "https://server1.carmelocampione.it:3000",
          api: "https://server1.carmelocampione.it:3000/api"
      }

      var accountManager = null;

      function securityHeaderHook() {
        return { Authorization: "Bearer " + accountManager.accessToken};
      }
      /* 
      function securityHeaderHook() {
        return { thapikey: accountManager.apiKey};
      }
      */

      var accountDataContext = new thingshub.AccountDataContext(endPointAddress, securityHeaderHook);
      accountManager = new thingshub.AccountManager("thingshub", accountDataContext);

      var thingsDatacontext = new thingshub.ThingsDataContext(endPointAddress, securityHeaderHook);

      var thingsGetParams =  {
        parentThingId : null,
        thingFilter : "",
        valueFilter : "",
        orderBy : "",
        skip : 0,
        top : 100
      }
      thingsDatacontext.getThings(thingsGetParams)
      .then(function(res) {
        console.log(res);
      });

      function authHook() {
        return "token=" + accountManager.accessToken;
      }
/*       
      function authHook() {
        return "token=" + accountManager.apiKey;
      }
 */
      function onError(error) {
        console.log(error);
      }
      function onConnectError(error) {
        console.log(error);
      }

      function onStateChanged(change) {
        console.log(change);
      }

      function onAPI(data) {
        console.log(data);
      }

      function onCreateThing(thingDTO) {
        console.log(thingDTO);
      }

      function onUpdateThing(thingDTO) {
        console.log(thingDTO);
      }

      function onUpdateThingValue(value) {
        console.log(value);
      }

      var socket = new thingshub.SocketIOConnector(endPointAddress.server, authHook, onError, onConnectError, onStateChanged);
      socket.subscribe();
      socket.setHook("api", onAPI);
      socket.setHook("onCreateThing", onCreateThing);
      socket.setHook("onUpdateThing", onUpdateThing);
      socket.setHook("onUpdateThingValue", onUpdateThingValue);
      
      socket.api()
      .then(function(res) {
        console.log(res);
      })
      .catch(function(err) {
        console.log(err);
      });

    </script>
    
</head>
<body>

	<div>
      
	</div>

</body>
</html>
