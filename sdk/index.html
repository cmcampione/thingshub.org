<!DOCTYPE html>

<html lang="it">

<head>

    <meta charset="utf-8" />

    <title>thinghub.org</title>

    <style>
    </style>

    <script src="node_modules/axios/dist/axios.min.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.slim.js"></script>
    
    <script src="dist/thingshub.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <script>

      var endPointAddress = {
          server: "https://api.thingshub.org:3000",
          api: "https://api.thingshub.org:3000/api"
      }

      var accountDataContext = new thingshub.AccountDataContext(endPointAddress);
      var accountManager = new thingshub.AccountManager("thingshub", accountDataContext, "491e94d9-9041-4e5e-b6cb-9dad91bbf63d");

      var thingsDatacontext = new thingshub.ThingsDataContext(endPointAddress, accountManager.getSecurityHeader);

      var mainThing = new thingshub.Thing();

      function onError(error) {
        console.log(error);
      }
      function onConnectError(error) {
        console.log(error);
      }

      function onStateChanged(change) {
        console.log(change);
      }

      function onAPI(data) {
        console.log(data);
      }

      function onUpdateThing(thingDTO) {
        console.log(thingDTO);
      }

      function onUpdateThingValue(value) {
        console.log(value);
      }

      var socket = new thingshub.SocketIOConnector(endPointAddress.server, accountManager.getSecurityToken, onError, onConnectError, onStateChanged);
      socket.subscribe();
      socket.setHook("api", onAPI);
      socket.setHook("onUpdateThing", onUpdateThing);
      socket.setHook("onUpdateThingValue", onUpdateThingValue);
      
      socket.api()
      .then(function(res) {
        console.log(res);
      })
      .catch(function(err) {
        console.log(err);
      });
      
      var thingsManagerClaims = {

        publicReadClaims : thingshub.ThingUserReadClaims.NoClaims,
        publicChangeClaims: thingshub.ThingUserChangeClaims.NoClaims,

        everyoneReadClaims: thingshub.ThingUserReadClaims.NoClaims,
        everyoneChangeClaims: thingshub.ThingUserChangeClaims.NoClaims,

        creatorUserReadClaims: thingshub.ThingUserReadClaims.AllClaims,
        creatorUserChangeClaims: thingshub.ThingUserChangeClaims.AllClaims
      }
      var thingsManager = new thingshub.ThingsManager(mainThing, "first thing", thingsManagerClaims, thingsDatacontext, socket );
      var httpRequestCanceler = new thingshub.HttpRequestCanceler();
      thingsManager.getMoreThings(httpRequestCanceler)
      .then((data) => {
        console.log(mainThing);        
      })
      .catch((e) => {
        console.log(e);
      })
    </script>

</head>
<body>

  <div id="things">
      <ol>
          <li v-for="thing in mainThing.children">
            {{ thing.name }}
          </li>
      </ol>
  </div>

  <script>
      var app = new Vue({
        el: '#things',
        data: {
          mainThing: mainThing
        }
      })
  </script>
  
</body>
</html>
